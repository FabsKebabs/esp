local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Create a Drawing object to represent the outline
local function DrawLine()
    local line = Drawing.new("Line")
    line.Visible = false
    line.Color = Color3.fromRGB(255, 0, 0) -- Red outline color
    line.Thickness = 2
    return line
end

local function CreateOutlineESP(player)
    if player == LocalPlayer then return end

    -- Initialize the outline lines
    local outlineLines = {}
    
    local function GetCharacterParts(character)
        local parts = {}
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                table.insert(parts, part)
            end
        end
        return parts
    end

    -- Create lines for each part of the character
    local function CreateCharacterOutline(character)
        local parts = GetCharacterParts(character)
        
        for _, part in pairs(parts) do
            local line = DrawLine()
            table.insert(outlineLines, line)

            -- Connect the parts with lines to form an outline
            local function UpdateOutline()
                RunService.RenderStepped:Connect(function()
                    if character and character:FindFirstChild(part.Name) then
                        local partPos, onScreen = Camera:WorldToViewportPoint(part.Position)

                        if onScreen then
                            line.Visible = true
                            line.From = Vector2.new(partPos.X, partPos.Y)
                            -- Adjust line based on position relative to camera view
                            -- (This part may require further adjustments for a smooth outline)
                            -- Example: lines connecting character body parts to outline
                            -- You can adjust the "From" and "To" coordinates for more precise outlines
                        else
                            line.Visible = false
                        end
                    else
                        line.Visible = false
                    end
                end)
            end

            coroutine.wrap(UpdateOutline)()
        end
    end

    -- Attach the outline to the player's character
    local function UpdateCharacter(player)
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            CreateCharacterOutline(player.Character)
        end
    end

    -- Update outline if player spawns
    player.CharacterAdded:Connect(function(character)
        CreateCharacterOutline(character)
    end)

    -- Initially create the outline if the character already exists
    if player.Character then
        UpdateCharacter(player)
    end
end

-- Initialize Outline ESP for existing players
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateOutlineESP(player)
    end
end

-- Add Outline ESP for new players
Players.PlayerAdded:Connect(function(player)
    CreateOutlineESP(player)
end)
