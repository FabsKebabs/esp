local LocalPlayer = game.Players.LocalPlayer
local ExpanderEnabled = true -- Match is active

-- Table to keep track of ESP markers for each player
local espMarkers = {}

-- Settings for ESP markers
local ESPSettings = {
    Size = 2, -- Default size of ESP circle
    Transparency = 0.5, -- Default transparency of ESP
    Color = Color3.fromRGB(255, 0, 0), -- Default color of ESP for enemy team (red)
}

-- Function to check if the player is currently in the match
function isInMatch()
    -- Replace with your logic to determine if the match is active
    return LocalPlayer.Team ~= nil
end

-- Function to show the ESP for players on the enemy team
function showESP(rootPart, player)
    -- Check if the ESP marker already exists for this player
    if not espMarkers[player.UserId] then
        -- If the ESP marker doesn't exist, create it
        local espMarker = Instance.new("Part")
        espMarker.Size = Vector3.new(ESPSettings.Size, ESPSettings.Size, ESPSettings.Size)  -- Adjust size
        espMarker.Shape = Enum.PartType.Ball
        espMarker.Color = ESPSettings.Color  -- Set color for the enemy team
        espMarker.CanCollide = false
        espMarker.Anchored = true
        espMarker.Parent = game.Workspace
        espMarker.Name = "ESPMarker"
        
        -- Save it to the espMarkers table
        espMarkers[player.UserId] = espMarker
    end
    
    -- Position the ESP marker above the player's root part
    local espMarker = espMarkers[player.UserId]
    espMarker.Position = rootPart.Position + Vector3.new(0, 3, 0)  -- Adjust Y offset
    espMarker.Transparency = ESPSettings.Transparency  -- Set transparency for the ESP
end

-- Function to hide the ESP for a player
function hideESP(player)
    -- Check if the ESP marker exists for this player
    local espMarker = espMarkers[player.UserId]
    if espMarker then
        espMarker:Destroy()
        espMarkers[player.UserId] = nil  -- Remove from the table
    end
end

-- Main function to update ESP
function updateESP()
    while ExpanderEnabled do
        wait(0.1)
        
        -- Only proceed if the match is active and we have teams
        if isInMatch() then
            for _, player in ipairs(game.Players:GetPlayers()) do
                -- Check if it's an enemy player (player is not LocalPlayer and on a different team)
                if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team then
                    local character = player.Character
                    if character then
                        local rootPart = character:FindFirstChild("HumanoidRootPart")
                        if rootPart then
                            -- Show the ESP for the enemy player
                            showESP(rootPart, player)
                        end
                    end
                end
            end
        else
            -- If not in a match, hide ESP for all players
            for _, player in ipairs(game.Players:GetPlayers()) do
                if player.Team ~= LocalPlayer.Team then
                    hideESP(player)
                end
            end
        end
    end
end

-- Start updating the ESP
updateESP()
